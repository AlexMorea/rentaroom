{% extends "listings/base.html" %} {% load static %} {% block content %}

<h1 class="page-title">Browse Rooms</h1>
<form class="search-bar" method="get" action="{% url 'room_list' %}">
  <input
    type="text"
    name="q"
    placeholder="Search (title, location, type...)"
    value="{{ values.q }}"
  />

  <input
    type="text"
    name="location"
    placeholder="Location (e.g. Pretoria, Mamelodi)"
    value="{{ values.location }}"
  />

  <select name="type">
    <option value="" {% if selected.any %}selected{% endif %}>Any Type</option>
    <option value="single" {% if selected.single %}selected{% endif %}>
      Single
    </option>
    <option value="shared" {% if selected.shared %}selected{% endif %}>
      Shared
    </option>
    <option value="flat" {% if selected.flat %}selected{% endif %}>
      Flat / Apartment
    </option>
  </select>

  <button type="submit">Search</button>
</form>

<div class="room-grid">
  {% for room in rooms %}
  <a href="{% url 'room_detail' room.id %}" class="room-card">
    <div class="room-media">
      <div class="image-slider">
        {% for img in room.images.all|slice:":10" %}
        <img src="{{ img.image.url }}" alt="Room image" loading="lazy" />
        {% empty %}
        <img src="{% static 'img/placeholder.jpg' %}" alt="No image" />
        {% endfor %}
      </div>

      {% if room.contact_count|default:0 >= 3 %}
      <span class="badge badge-popular">Popular</span>
      {% endif %} {% if room.owner.profile.is_verified %}
      <span class="badge badge-verified">Verified</span>
      {% endif %}
    </div>

    <div class="room-info">
      <h3 class="room-title">{{ room.title }}</h3>
      <p class="room-meta">{{ room.location }}</p>
      <p class="room-price">R {{ room.price }}</p>

      {% if room.avg_rating %}
      <p class="rating">‚≠ê {{ room.avg_rating|floatformat:1 }}/5</p>
      {% endif %}
    </div>
  </a>
  {% empty %}
  <p class="empty-state">No rooms available.</p>
  {% endfor %}
</div>

{% endblock %}
